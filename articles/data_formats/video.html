<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="prev" title="Software Events" href="software_events.html" />

    <link rel="shortcut icon" href="../../_static/favicon.ico"/><!-- Generated with Sphinx 7.2.6 and Furo 2024.08.06 -->
        <title>Video - AIND Behavior Services</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">AIND Behavior Services</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../_static/light-logo.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../_static/dark-logo.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">AIND Behavior Services</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Welcome to AIND Behavior Servicesâ€™s documentation!</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api.html">API</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api.base.html">base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api.rig.html">rig</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api.task_logic.html">task_logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api.session.html">session</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api.data_types.html">data_types</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api.calibration.html">calibration</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of calibration</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api.calibration/aind_manipulator.html">aind_manipulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api.calibration/load_cells.html">load_cells</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api.calibration/olfactometer.html">olfactometer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api.calibration/water_valve.html">water_valve</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api.calibration/treadmill.html">treadmill</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api.utils.html">utils</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../json_schemas.html">JsonSchema</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of JsonSchema</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../json_schemas/aind_behavior_data_types.html">aind_behavior_data_types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../json_schemas/aind_behavior_session.html">aind_behavior_session</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../json_schemas/aind_behavior_subject_database.html">aind_behavior_subject_database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../json_schemas/aind_manipulator_calibration_logic.html">aind_manipulator_calibration_logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../json_schemas/aind_manipulator_calibration_rig.html">aind_manipulator_calibration_rig</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../data_formats.html">Data formats</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Data formats</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../core/conventions.html">Standard conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core/dataset_structure.html">Dataset structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="harp.html">Harp</a></li>
<li class="toctree-l2"><a class="reference internal" href="software_events.html">Software Events</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Video</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/AllenNeuralDynamics/Aind.Behavior.Services">GitHub Source Code</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/articles/data_formats/video.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="video">
<h1>Video<a class="headerlink" href="#video" title="Link to this heading">Â¶</a></h1>
<section id="version">
<h2>Version<a class="headerlink" href="#version" title="Link to this heading">Â¶</a></h2>
<p>0.1.0-draft</p>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">Â¶</a></h2>
<p>This document describes the standards for acquiring video data from behavior experiments. The goal is to ensure that the data is correctly acquired, logged, and stored in a way that is compatible with AINDâ€™s data processing pipelines. We will draw the line on including metadata that relates to the video data itself and NOT to the hardware or software that acquired it. This is to ensure that the data format is self-contained, maintainable and potentially reusable by other applications.</p>
</section>
<section id="format-specification">
<h2>Format specification<a class="headerlink" href="#format-specification" title="Link to this heading">Â¶</a></h2>
<p>Following SciComp standards, video data from behavior experiments should be saved to the <code class="docutils literal notranslate"><span class="pre">behavior-videos</span></code> modality folder.</p>
<p>Inside this folder, each camera should have its own directory, named <code class="docutils literal notranslate"><span class="pre">&lt;CameraName&gt;</span></code>. Inside each camera folder, there should be two files: <code class="docutils literal notranslate"><span class="pre">video.&lt;extension&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">metadata.csv</span></code>. The <code class="docutils literal notranslate"><span class="pre">video.&lt;extension&gt;`</span></code> file should contain the video data, and the <code class="docutils literal notranslate"><span class="pre">metadata.csv</span></code> file should contain the metadata for the video.</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;CameraName&gt;</span></code> is expected to match the name defined in the rig metadata file (<code class="docutils literal notranslate"><span class="pre">rig.json</span></code>) from <a class="reference external" href="https://aind-data-schema.readthedocs.io/en/latest/rig.html">aind-data-schema</a>.</p>
<p>The folder structure will thus be:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ðŸ“¦behavior-videos
â”£ ðŸ“‚BodyCamera
â”ƒ â”£ ðŸ“œmetadata.csv
â”ƒ â”— ðŸ“œvideo.mp4
â”— ðŸ“‚FaceCamera
â”ƒ â”£ ðŸ“œmetadata.csv
â”ƒ â”— ðŸ“œvideo.mp4
</pre></div>
</div>
<p>If multiple streams from the same camera are acquired in the same session, an optional <code class="docutils literal notranslate"><span class="pre">datetime</span></code> suffix can be added to the containerâ€™s name:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ðŸ“¦behavior-videos
â”£ ðŸ“‚BodyCamera_2023-12-25T133015Z
â”ƒ â”£ ðŸ“œmetadata.cs
â”ƒ â”— ðŸ“œvideo.mp4
â”— ðŸ“‚BodyCamera_2023-12-25T145001Z
â”ƒ â”£ ðŸ“œmetadata.csv
â”ƒ â”— ðŸ“œvideo.mp4
</pre></div>
</div>
<p>The metadata file is expected to contain the following columns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ReferenceTime`</span></code> - Time of the trigger given by hardware (e.g. Harp)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CameraFrameNumber</span></code> â€“ Frame counter given by the camera API or manually added by user (e.g. using OS counter for webcams)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CameraFrameTime</span></code> â€“ Frame acquisition time given by the camera API or manually added by the user (e.g. using OS scheduler for webcams).</p></li>
</ul>
<p>As for the video, since the format will depend on the scientific question and software/hardware constrains, we will not enforce a specification. However, we strongly discourage the use of RAW, uncompressed data, and should the user not have a preference, we suggest the follow default:</p>
<p>Since this format will depend on the scientific question and software/hardware constrains, we will not enforce a specific format. However, if the user does not have a preference we suggest using the defaults defined in:
<code class="docutils literal notranslate"><span class="pre">~aind_behavior_services.rig.VideoWriterFfmpeg</span></code></p>
<p>or</p>
<ul class="simple">
<li><p>Use mp4 container</p></li>
<li><p>Acquire without any gamma correction</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code> with the encoding codec string for online encoding (optimized for compression quality and speed) set to the default values defined in <code class="xref py py-attr docutils literal notranslate"><span class="pre">FFMPEG_OUTPUT_8BIT</span></code> and <code class="xref py py-attr docutils literal notranslate"><span class="pre">FFMPEG_INPUT</span></code>:</p></li>
</ul>
<p>The following encoding codec string can be used for offline re-encoding (optimized for quality and size):</p>
<ul class="simple">
<li><p>output arguments: <code class="docutils literal notranslate"><span class="pre">-vf</span> <span class="pre">&quot;scale=out_color_matrix=bt709:out_range=full:sws_dither=none,format=yuv420p10le,colorspace=ispace=bt709:all=bt709:dither=none,scale=out_range=tv:sws_dither=none,format=yuv420p&quot;</span> <span class="pre">-c:v</span> <span class="pre">libx264</span> <span class="pre">-preset</span> <span class="pre">veryslow</span> <span class="pre">-crf</span> <span class="pre">18</span> <span class="pre">-pix_fmt</span> <span class="pre">yuv420p</span> <span class="pre">-metadata</span> <span class="pre">author=&quot;Allen</span> <span class="pre">Institute</span> <span class="pre">for</span> <span class="pre">Neural</span> <span class="pre">Dynamics&quot;</span> <span class="pre">-movflags</span> <span class="pre">+faststart+write_colr</span></code></p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This pipeline has been designed and tested with monochrome videos with the raw pixel format <code class="docutils literal notranslate"><span class="pre">gray</span></code>. For color videos, the arguments might need to be altered to match the color space of the input.</p>
<p>For higher bit depth (more than 8 bit) recordings, change the output arguments of the online, first stage, encoding to <code class="xref py py-attr docutils literal notranslate"><span class="pre">FFMPEG_OUTPUT_16BIT</span></code>
This is almost the same, except the intermediate color representation is 48 bits per pixel instead of 24.</p>
</div>
</section>
<section id="application-notes">
<h2>Application notes<a class="headerlink" href="#application-notes" title="Link to this heading">Â¶</a></h2>
<dl class="simple">
<dt>We currently support the following cameras:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Blackfly</span> <span class="pre">S</span> <span class="pre">BFS-U3-16S2M</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Blackfly</span> <span class="pre">S</span> <span class="pre">BFS-U3-04S2M</span></code></p></li>
</ul>
</dd>
</dl>
<p>Additional cameras could be supported but the user should provide the necessary information to integrate it with the current pipeline.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is the userâ€™s responsibility to ensure that:
- The camera is correctly calibrated and that the settings are appropriate for the experiment.</p>
<ul class="simple">
<li><p>Unless there is a reason not to, the default logging pattern should always follow the following logic: (Stop trigger if needed) -&gt; Start logging -&gt; Start Camera -&gt; Start Trigger -Acquire data -&gt; Stop Trigger -&gt; Stop Logging. This guarantees that all relevant events are recorded.</p></li>
<li><p>Trigger generation only starts AFTER the camera hardware has been initialized. This is to ensure that the camera is ready to receive the first trigger signal.</p></li>
<li><p>For each trigger of the trigger source (e.g. Harp Behavior board) a corresponding camera exposure should occur. One example where this can be violated is if the set exposure is greater than the trigger frequency.</p></li>
<li><p>In absence of dropped frames (defined as skips in the FrameNumber 1) the metadata.csv file is expected to be aligned with the video file.</p></li>
<li><p>(Optional) Start trigger and Stop trigger events should be available for QC.</p></li>
<li><p>(Optional) The logs of all triggers (regardless of whether they are logged in the metadata.csv) should be saved for redundancy.</p></li>
</ul>
</div>
<section id="acquisition-and-logging">
<h3>Acquisition and Logging<a class="headerlink" href="#acquisition-and-logging" title="Link to this heading">Â¶</a></h3>
<p>Acquisition can be achieved using Bonsai. An operator that instantiates the camera can be found in <a class="reference external" href="https://allenneuraldynamics.github.io/Bonsai.AllenNeuralDynamics/api/AllenNeuralDynamics.Core.AindSpinnakerCapture.html">AllenNeuralDynamics.Core package</a>.
This operator is a wrapper around the Spinnaker SDK and provides a simple interface to acquire video data. Since it forces the camera into the correct settings (e.g. Trigger mode, disabled gamma correction, etcâ€¦), it guarantees that camera metadata is static and thus easier to track.</p>
<p>Logging can be implemented via the <a class="reference external" href="https://allenneuraldynamics.github.io/Bonsai.AllenNeuralDynamics/api/AllenNeuralDynamics.Core.FfmpegVideoWriter.html">FFMPEG operator</a>.</p>
<p>While we suggest using the aforementioned recipes, the user is free to use any software that can acquire video data, provided it is validated and logged in the correct format.</p>
</section>
</section>
<section id="relationship-to-aind-data-schema">
<h2>Relationship to aind-data-schema<a class="headerlink" href="#relationship-to-aind-data-schema" title="Link to this heading">Â¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">&lt;CameraName&gt;</span></code> is expected to match the name defined in the rig metadata file (<code class="docutils literal notranslate"><span class="pre">rig.json</span></code>). Several fields in the metadata can be automatically extracted from this file format (e.g. start and stop of the stream, resolution of the video). However, the user should ensure that any data pertaining to the hardware configuration (e.g. camera model, exposure time, gain, camera position, etcâ€¦) is logged independently from this file format herein described. In the case of this repository, the metadata will be defined in the <code class="xref py py-class docutils literal notranslate"><span class="pre">AindBehaviorRigModel</span></code> instances.</p>
</section>
<section id="file-quality-assurances">
<h2>File Quality Assurances<a class="headerlink" href="#file-quality-assurances" title="Link to this heading">Â¶</a></h2>
<p>The following features should be true if the data asset is to be considered valid:</p>
<ul>
<li><p>The number of frames in the encoded video should match the number of recorded frames and the number of frames in the metadata.</p></li>
<li><p>Check if dropped frames occurred. This should be done in two ways:</p>
<ul>
<li><p>The difference between adjacent <code class="docutils literal notranslate"><span class="pre">FrameNumber</span></code> is always 1;</p></li>
<li><p>The difference between adjacent <code class="docutils literal notranslate"><span class="pre">Seconds</span></code> and adjacent <code class="docutils literal notranslate"><span class="pre">FrameTime</span></code> should be very close (I would suggest a threshold of 0.5ms for now);</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While dropped frames are not ideal, they do not necessarily invalidate the data. However, the user should be aware of the potential consequences and/or ways to correct the data asset.</p>
</div>
</li>
</ul>
</li>
<li><p>If using a stable frame rate (this should be inferred from a rig configuration file), the average frame rate should match the theoretical frame rate;</p></li>
<li><p>(optional) If the optional start and stop events are provided, the following temporal order should be asserted: <code class="docutils literal notranslate"><span class="pre">All(StartTrigger</span> <span class="pre">&lt;</span> <span class="pre">Frames</span>&#160; <span class="pre">&lt;</span> <span class="pre">StopTrigger&gt;)</span></code></p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="software_events.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Software Events</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Video</a><ul>
<li><a class="reference internal" href="#version">Version</a></li>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#format-specification">Format specification</a></li>
<li><a class="reference internal" href="#application-notes">Application notes</a><ul>
<li><a class="reference internal" href="#acquisition-and-logging">Acquisition and Logging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#relationship-to-aind-data-schema">Relationship to aind-data-schema</a></li>
<li><a class="reference internal" href="#file-quality-assurances">File Quality Assurances</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=11e62b30"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    </body>
</html>